[
  {
    "id": "schema:overview",
    "text": "E-commerce analytics database schema with 7 tables: metadata (data dictionary), sessions (browsing sessions with UTM tracking), pageviews (page load events), orders (purchase transactions), order_items (line items), products (catalog), refunds (returns). Key relationships: sessions->orders->order_items->refunds. Revenue and COGS calculated at order_items level.",
    "metadata": {
      "doc_type": "schema_overview",
      "domain": "ecommerce"
    }
  },
  {
    "id": "table:metadata",
    "text": "Table: metadata. Data dictionary table with columns [Table] (nvarchar 25), [Field] (varchar 60), [Description] (varchar 128). Stores human-readable field descriptions.",
    "metadata": {
      "doc_type": "table",
      "table": "metadata"
    }
  },
  {
    "id": "table:sessions",
    "text": "Table: sessions. Tracks user browsing sessions. Primary key: session_id. Contains user_id, created_at, is_repeat_session, marketing attribution (utm_source, utm_campaign, utm_content), device_type, http_referer. Join to orders via session_id and to pageviews via session_id.",
    "metadata": {
      "doc_type": "table",
      "table": "sessions"
    }
  },
  {
    "id": "table:pageviews",
    "text": "Table: pageviews. Records individual page loads. Primary key: pageview_id. Contains created_at, session_id (FK to sessions), pageview_url. Used for engagement and funnel analysis.",
    "metadata": {
      "doc_type": "table",
      "table": "pageviews"
    }
  },
  {
    "id": "table:orders",
    "text": "Table: orders. Purchase transactions. Primary key: order_id. Contains created_at, session_id (FK to sessions), user_id, primary_product_id, items_purchased, price_usd, price_inr, cogs_usd, cogs_inr. Join to order_items via order_id. Order-level fields are aggregates; order_items is source of truth for revenue/COGS.",
    "metadata": {
      "doc_type": "table",
      "table": "orders"
    }
  },
  {
    "id": "table:order_items",
    "text": "Table: order_items. Line items within orders. Primary key: order_item_id. Contains order_id (FK to orders), created_at, product_id (FK to products), is_primary_item (1=primary, 0=addon), price_usd, price_inr, cogs_usd, cogs_inr. This is the canonical source for all revenue and COGS calculations.",
    "metadata": {
      "doc_type": "table",
      "table": "order_items"
    }
  },
  {
    "id": "table:products",
    "text": "Table: products. Product catalog. Primary key: product_id. Contains created_at, product_name (varchar 128). Referenced by order_items.product_id and orders.primary_product_id.",
    "metadata": {
      "doc_type": "table",
      "table": "products"
    }
  },
  {
    "id": "table:refunds",
    "text": "Table: refunds. Money returned to customers. Primary key: refund_id. Contains created_at, order_item_id (FK to order_items), order_id (FK to orders), refund_amount_usd, refund_amount_inr. Refunds reduce net revenue but do NOT reduce COGS.",
    "metadata": {
      "doc_type": "table",
      "table": "refunds"
    }
  },
  {
    "id": "col:metadata.Table",
    "text": "Column metadata.[Table] (nvarchar 25 NULL). Name of table being documented. Note: Column name has square brackets and capital T.",
    "metadata": {
      "doc_type": "column",
      "table": "metadata",
      "column": "[Table]"
    }
  },
  {
    "id": "col:metadata.Field",
    "text": "Column metadata.[Field] (varchar 60 NULL). Name of field/column being documented. Note: Column name has square brackets and capital F.",
    "metadata": {
      "doc_type": "column",
      "table": "metadata",
      "column": "[Field]"
    }
  },
  {
    "id": "col:metadata.Description",
    "text": "Column metadata.[Description] (varchar 128 NULL). Human-readable description of the field. Note: Column name has square brackets and capital D.",
    "metadata": {
      "doc_type": "column",
      "table": "metadata",
      "column": "[Description]"
    }
  },
  {
    "id": "col:sessions.session_id",
    "text": "Column sessions.session_id (int). Primary key. Unique identifier for each browsing session. Join to orders.session_id and pageviews.session_id.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "session_id",
      "semantic_type": "primary_key"
    }
  },
  {
    "id": "col:sessions.created_at",
    "text": "Column sessions.created_at (DATETIME). Timestamp when session was created, UTC format. Use for time-based filtering and trend analysis.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "created_at",
      "semantic_type": "timestamp"
    }
  },
  {
    "id": "col:sessions.user_id",
    "text": "Column sessions.user_id (int). Links session to user. Same user can have multiple sessions. Use for cross-session user behavior tracking.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "user_id",
      "semantic_type": "foreign_key"
    }
  },
  {
    "id": "col:sessions.is_repeat_session",
    "text": "Column sessions.is_repeat_session (int). Boolean flag: 1=user has prior sessions, 0=first-time visitor. Use to segment new vs returning traffic.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "is_repeat_session",
      "semantic_type": "boolean_flag"
    }
  },
  {
    "id": "col:sessions.utm_source",
    "text": "Column sessions.utm_source (varchar 60 NULL). Marketing source (google, facebook, email, etc). NULL=direct or unknown traffic. Use for channel attribution analysis.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "utm_source",
      "semantic_type": "marketing_dimension",
      "synonyms": [
        "source",
        "channel",
        "traffic source",
        "marketing channel"
      ]
    }
  },
  {
    "id": "col:sessions.utm_campaign",
    "text": "Column sessions.utm_campaign (VARCHAR 128 NULL). Campaign identifier (summer_sale_2024, etc). Use for campaign performance tracking.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "utm_campaign",
      "semantic_type": "marketing_dimension",
      "synonyms": [
        "campaign",
        "campaign name",
        "promotion"
      ]
    }
  },
  {
    "id": "col:sessions.utm_content",
    "text": "Column sessions.utm_content (VARCHAR 128 NULL). Content variant or A/B test identifier. Use for creative performance analysis.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "utm_content",
      "semantic_type": "marketing_dimension",
      "synonyms": [
        "content",
        "ad variant",
        "creative"
      ]
    }
  },
  {
    "id": "col:sessions.device_type",
    "text": "Column sessions.device_type (VARCHAR 60 NULL). Device category: desktop, mobile, tablet. Use for device performance analysis.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "device_type",
      "semantic_type": "device_dimension",
      "synonyms": [
        "device",
        "platform"
      ]
    }
  },
  {
    "id": "col:sessions.http_referer",
    "text": "Column sessions.http_referer (NVARCHAR 128 NULL). URL user came from before reaching site. NULL=no referrer. Use to identify organic referral traffic.",
    "metadata": {
      "doc_type": "column",
      "table": "sessions",
      "column": "http_referer",
      "semantic_type": "referrer",
      "synonyms": [
        "referrer",
        "referer",
        "referring site"
      ]
    }
  },
  {
    "id": "col:pageviews.pageview_id",
    "text": "Column pageviews.pageview_id (int). Primary key. Unique identifier for each page load event.",
    "metadata": {
      "doc_type": "column",
      "table": "pageviews",
      "column": "pageview_id",
      "semantic_type": "primary_key"
    }
  },
  {
    "id": "col:pageviews.created_at",
    "text": "Column pageviews.created_at (DATETIME). Timestamp when page was viewed, UTC format. Use for engagement timing and funnel analysis.",
    "metadata": {
      "doc_type": "column",
      "table": "pageviews",
      "column": "created_at",
      "semantic_type": "timestamp"
    }
  },
  {
    "id": "col:pageviews.session_id",
    "text": "Column pageviews.session_id (int). Links pageview to parent session. Foreign key to sessions.session_id.",
    "metadata": {
      "doc_type": "column",
      "table": "pageviews",
      "column": "session_id",
      "semantic_type": "foreign_key"
    }
  },
  {
    "id": "col:pageviews.pageview_url",
    "text": "Column pageviews.pageview_url (nvarchar 256 NULL). Full path or URL of page viewed (/products/tshirt, /cart). Use LIKE patterns for page type filtering.",
    "metadata": {
      "doc_type": "column",
      "table": "pageviews",
      "column": "pageview_url",
      "semantic_type": "url",
      "synonyms": [
        "url",
        "page",
        "page path"
      ]
    }
  },
  {
    "id": "col:orders.order_id",
    "text": "Column orders.order_id (int). Primary key. Unique identifier for each order. Join to order_items.order_id and refunds.order_id.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "order_id",
      "semantic_type": "primary_key",
      "synonyms": [
        "order",
        "transaction id"
      ]
    }
  },
  {
    "id": "col:orders.created_at",
    "text": "Column orders.created_at (DATETIME). Timestamp when order was placed, UTC format. Use for time-based analysis and cohort calculations.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "created_at",
      "semantic_type": "timestamp",
      "synonyms": [
        "order date",
        "purchase date"
      ]
    }
  },
  {
    "id": "col:orders.session_id",
    "text": "Column orders.session_id (int). Links order to session where purchase occurred. Foreign key to sessions.session_id. Critical for last-touch attribution.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "session_id",
      "semantic_type": "foreign_key"
    }
  },
  {
    "id": "col:orders.user_id",
    "text": "Column orders.user_id (int). Identifies user who placed order. Use for customer lifetime value and repeat purchase analysis.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "user_id",
      "semantic_type": "foreign_key",
      "synonyms": [
        "customer",
        "buyer"
      ]
    }
  },
  {
    "id": "col:orders.primary_product_id",
    "text": "Column orders.primary_product_id (int). Main product driving this order. Foreign key to products.product_id. Denormalized from order_items where is_primary_item=1.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "primary_product_id",
      "semantic_type": "foreign_key",
      "synonyms": [
        "main product",
        "primary sku"
      ]
    }
  },
  {
    "id": "col:orders.items_purchased",
    "text": "Column orders.items_purchased (int). Count of line items in this order. Denormalized count of order_items rows for this order_id.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "items_purchased",
      "semantic_type": "count",
      "synonyms": [
        "item count",
        "basket size"
      ]
    }
  },
  {
    "id": "col:orders.price_usd",
    "text": "Column orders.price_usd (float). Total order price in USD. Denormalized sum of order_items.price_usd. For calculations, use order_items table as source of truth.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "price_usd",
      "semantic_type": "currency_usd",
      "synonyms": [
        "order value",
        "revenue",
        "order total"
      ]
    }
  },
  {
    "id": "col:orders.price_inr",
    "text": "Column orders.price_inr (float). Total order price in INR. Calculated from price_usd via USD to INR conversion. Use for India-specific reporting.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "price_inr",
      "semantic_type": "currency_inr",
      "synonyms": [
        "order value inr",
        "revenue rupees"
      ]
    }
  },
  {
    "id": "col:orders.cogs_usd",
    "text": "Column orders.cogs_usd (float). Total cost of goods sold for order in USD. Denormalized sum of order_items.cogs_usd. For calculations, use order_items table.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "cogs_usd",
      "semantic_type": "currency_usd",
      "synonyms": [
        "cost",
        "product cost"
      ]
    }
  },
  {
    "id": "col:orders.cogs_inr",
    "text": "Column orders.cogs_inr (float). Total COGS in INR. Calculated from cogs_usd via USD to INR conversion.",
    "metadata": {
      "doc_type": "column",
      "table": "orders",
      "column": "cogs_inr",
      "semantic_type": "currency_inr"
    }
  },
  {
    "id": "col:order_items.order_item_id",
    "text": "Column order_items.order_item_id (int). Primary key. Unique identifier for each line item. Join to refunds.order_item_id.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "order_item_id",
      "semantic_type": "primary_key",
      "synonyms": [
        "line item id"
      ]
    }
  },
  {
    "id": "col:order_items.order_id",
    "text": "Column order_items.order_id (int). Links line item to parent order. Foreign key to orders.order_id.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "order_id",
      "semantic_type": "foreign_key"
    }
  },
  {
    "id": "col:order_items.created_at",
    "text": "Column order_items.created_at (DATETIME). Timestamp when line item was created, UTC format. Typically matches orders.created_at.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "created_at",
      "semantic_type": "timestamp"
    }
  },
  {
    "id": "col:order_items.product_id",
    "text": "Column order_items.product_id (int). Product sold in this line item. Foreign key to products.product_id.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "product_id",
      "semantic_type": "foreign_key",
      "synonyms": [
        "product",
        "sku"
      ]
    }
  },
  {
    "id": "col:order_items.is_primary_item",
    "text": "Column order_items.is_primary_item (int). Boolean flag: 1=primary product driving order, 0=add-on/upsell. Use to segment primary vs cross-sell revenue.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "is_primary_item",
      "semantic_type": "boolean_flag",
      "synonyms": [
        "primary item",
        "addon",
        "upsell flag"
      ]
    }
  },
  {
    "id": "col:order_items.price_usd",
    "text": "Column order_items.price_usd (float). Item-level selling price in USD. CANONICAL SOURCE for all revenue calculations. Always use this table, not orders.price_usd, for accurate revenue analysis.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "price_usd",
      "semantic_type": "currency_usd",
      "canonical": "revenue_source",
      "synonyms": [
        "item price",
        "revenue",
        "sales price"
      ]
    }
  },
  {
    "id": "col:order_items.price_inr",
    "text": "Column order_items.price_inr (float). Item-level price in INR. Calculated from price_usd via USD to INR conversion. CANONICAL SOURCE for INR revenue.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "price_inr",
      "semantic_type": "currency_inr",
      "canonical": "revenue_source"
    }
  },
  {
    "id": "col:order_items.cogs_usd",
    "text": "Column order_items.cogs_usd (float). Item-level cost of goods sold in USD. CANONICAL SOURCE for all COGS calculations. Always use this table, not orders.cogs_usd.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "cogs_usd",
      "semantic_type": "currency_usd",
      "canonical": "cogs_source",
      "synonyms": [
        "item cost",
        "product cost"
      ]
    }
  },
  {
    "id": "col:order_items.cogs_inr",
    "text": "Column order_items.cogs_inr (float). Item-level COGS in INR. Calculated from cogs_usd via USD to INR conversion. CANONICAL SOURCE for INR COGS.",
    "metadata": {
      "doc_type": "column",
      "table": "order_items",
      "column": "cogs_inr",
      "semantic_type": "currency_inr",
      "canonical": "cogs_source"
    }
  },
  {
    "id": "col:products.product_id",
    "text": "Column products.product_id (int). Primary key. Unique identifier for each product. Stable over time even if product_name changes.",
    "metadata": {
      "doc_type": "column",
      "table": "products",
      "column": "product_id",
      "semantic_type": "primary_key",
      "synonyms": [
        "product",
        "sku"
      ]
    }
  },
  {
    "id": "col:products.created_at",
    "text": "Column products.created_at (DATETIME). Timestamp when product was added to catalog, UTC format.",
    "metadata": {
      "doc_type": "column",
      "table": "products",
      "column": "created_at",
      "semantic_type": "timestamp"
    }
  },
  {
    "id": "col:products.product_name",
    "text": "Column products.product_name (varchar 128 NULL). Descriptive name of product. May change over time; product_id is stable identifier.",
    "metadata": {
      "doc_type": "column",
      "table": "products",
      "column": "product_name",
      "semantic_type": "name",
      "synonyms": [
        "name",
        "product title"
      ]
    }
  },
  {
    "id": "col:refunds.refund_id",
    "text": "Column refunds.refund_id (int). Primary key. Unique identifier for each refund event.",
    "metadata": {
      "doc_type": "column",
      "table": "refunds",
      "column": "refund_id",
      "semantic_type": "primary_key"
    }
  },
  {
    "id": "col:refunds.created_at",
    "text": "Column refunds.created_at (DATETIME). Timestamp when refund was issued, UTC format.",
    "metadata": {
      "doc_type": "column",
      "table": "refunds",
      "column": "created_at",
      "semantic_type": "timestamp",
      "synonyms": [
        "refund date"
      ]
    }
  },
  {
    "id": "col:refunds.order_item_id",
    "text": "Column refunds.order_item_id (int). Links refund to specific line item being refunded. Foreign key to order_items.order_item_id.",
    "metadata": {
      "doc_type": "column",
      "table": "refunds",
      "column": "order_item_id",
      "semantic_type": "foreign_key"
    }
  },
  {
    "id": "col:refunds.order_id",
    "text": "Column refunds.order_id (int). Links refund to parent order. Foreign key to orders.order_id. Useful for order-level refund aggregation.",
    "metadata": {
      "doc_type": "column",
      "table": "refunds",
      "column": "order_id",
      "semantic_type": "foreign_key"
    }
  },
  {
    "id": "col:refunds.refund_amount_usd",
    "text": "Column refunds.refund_amount_usd (float). Amount refunded to customer in USD. Can be partial or full refund of item price. Reduces net revenue.",
    "metadata": {
      "doc_type": "column",
      "table": "refunds",
      "column": "refund_amount_usd",
      "semantic_type": "currency_usd",
      "synonyms": [
        "refund",
        "return amount"
      ]
    }
  },
  {
    "id": "col:refunds.refund_amount_inr",
    "text": "Column refunds.refund_amount_inr (float). Refund amount in INR. Calculated from refund_amount_usd via USD to INR conversion.",
    "metadata": {
      "doc_type": "column",
      "table": "refunds",
      "column": "refund_amount_inr",
      "semantic_type": "currency_inr"
    }
  },
  {
    "id": "rel:foreign_keys",
    "text": "Foreign key relationships: orders.session_id->sessions.session_id, orders.order_id->order_items.order_id, order_items.product_id->products.product_id, order_items.order_item_id->refunds.order_item_id, refunds.order_id->orders.order_id, pageviews.session_id->sessions.session_id.",
    "metadata": {
      "doc_type": "relationships",
      "type": "foreign_keys"
    }
  },
  {
    "id": "rel:revenue_join_path",
    "text": "Revenue calculation join path: Start from order_items (canonical source), LEFT JOIN refunds ON order_items.order_item_id=refunds.order_item_id, JOIN orders ON order_items.order_id=orders.order_id, JOIN sessions ON orders.session_id=sessions.session_id for attribution.",
    "metadata": {
      "doc_type": "relationships",
      "type": "join_path",
      "use_case": "revenue"
    }
  },
  {
    "id": "rel:funnel_join_path",
    "text": "Funnel analysis join path: sessions LEFT JOIN pageviews ON sessions.session_id=pageviews.session_id LEFT JOIN orders ON sessions.session_id=orders.session_id. Count distinct session_id, pageview_id, order_id for conversion rates.",
    "metadata": {
      "doc_type": "relationships",
      "type": "join_path",
      "use_case": "funnel"
    }
  },
  {
    "id": "rule:currency_conversion",
    "text": "Currency conversion rule: price_inr, cogs_inr, refund_amount_inr are calculated from corresponding _usd fields via USD to INR exchange rate conversion. Always use _usd fields as source of truth for calculations.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "currency"
    }
  },
  {
    "id": "rule:net_revenue",
    "text": "Net Revenue calculation: SUM(order_items.price_usd) - COALESCE(SUM(refunds.refund_amount_usd), 0). Calculate at order_items level, LEFT JOIN to refunds. Refunds reduce revenue. Use order_items as canonical source, not orders table.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "metric",
      "metric": "net_revenue"
    }
  },
  {
    "id": "rule:gross_revenue",
    "text": "Gross Revenue calculation: SUM(order_items.price_usd). Includes all items sold, even if later refunded. Does not subtract refunds.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "metric",
      "metric": "gross_revenue"
    }
  },
  {
    "id": "rule:cogs",
    "text": "COGS calculation: SUM(order_items.cogs_usd). COGS is NOT reduced by refunds. Refunds affect revenue only, not cost. Use order_items as canonical source.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "metric",
      "metric": "cogs"
    }
  },
  {
    "id": "rule:gross_profit",
    "text": "Gross Profit calculation: Net Revenue - Total COGS = (SUM(order_items.price_usd) - COALESCE(SUM(refunds.refund_amount_usd), 0)) - SUM(order_items.cogs_usd).",
    "metadata": {
      "doc_type": "business_rule",
      "category": "metric",
      "metric": "gross_profit"
    }
  },
  {
    "id": "rule:aov",
    "text": "Average Order Value (AOV) calculation: Total Net Revenue / Count of Net Orders. Net Orders = orders where net revenue > 0 (exclude fully refunded orders). Calculate net revenue per order, filter zeros, then average.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "metric",
      "metric": "aov"
    }
  },
  {
    "id": "rule:attribution",
    "text": "Marketing attribution: Last-touch model. Credit order to UTM parameters (utm_source, utm_campaign, utm_content) and device_type from the session where order was placed. Join orders.session_id to sessions.session_id to get attribution dimensions.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "attribution",
      "model": "last_touch"
    }
  },
  {
    "id": "rule:direct_traffic",
    "text": "Traffic classification: Direct traffic = utm_source IS NULL AND http_referer IS NULL. Organic referral = utm_source IS NULL AND http_referer IS NOT NULL. Paid/campaign = utm_source IS NOT NULL.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "traffic_classification"
    }
  },
  {
    "id": "rule:primary_vs_addon",
    "text": "Primary vs Add-on revenue: Use order_items.is_primary_item flag. Primary revenue: WHERE is_primary_item=1. Add-on/cross-sell revenue: WHERE is_primary_item=0. Always calculate at order_items level.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "revenue_segmentation"
    }
  },
  {
    "id": "rule:time_filter",
    "text": "Time-based filtering: All tables have created_at (DATETIME, UTC). For 'last N days' use: WHERE created_at >= DATEADD(day, -N, GETDATE()). For 'this month' use: WHERE created_at >= DATEFROMPARTS(YEAR(GETDATE()), MONTH(GETDATE()), 1).",
    "metadata": {
      "doc_type": "business_rule",
      "category": "time_logic"
    }
  },
  {
    "id": "rule:conversion_rate",
    "text": "Conversion rate calculation: COUNT(DISTINCT orders.order_id) / COUNT(DISTINCT sessions.session_id). Join sessions LEFT JOIN orders ON sessions.session_id=orders.session_id. Measures percentage of sessions that resulted in a purchase.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "metric",
      "metric": "conversion_rate"
    }
  },
  {
    "id": "rule:refund_rate",
    "text": "Refund rate calculation: SUM(refunds.refund_amount_usd) / SUM(order_items.price_usd). Measures percentage of gross revenue that was refunded. Higher = more quality issues or returns.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "metric",
      "metric": "refund_rate"
    }
  },
  {
    "id": "rule:repeat_customer",
    "text": "Repeat customer definition: User with 2 or more distinct orders. Query: SELECT user_id FROM orders GROUP BY user_id HAVING COUNT(DISTINCT order_id) >= 2.",
    "metadata": {
      "doc_type": "business_rule",
      "category": "customer_segmentation",
      "metric": "repeat_customer"
    }
  },
  {
    "id": "sql:net_revenue_last_30d",
    "text": "SQL - Net revenue last 30 days: SELECT SUM(oi.price_usd) - COALESCE(SUM(r.refund_amount_usd), 0) AS net_revenue FROM order_items oi LEFT JOIN refunds r ON oi.order_item_id = r.order_item_id WHERE oi.created_at >= DATEADD(day, -30, GETDATE())",
    "metadata": {
      "doc_type": "sql_example",
      "use_case": "net_revenue"
    }
  },
  {
    "id": "sql:top_products_by_revenue",
    "text": "SQL - Top products by net revenue: SELECT oi.product_id, p.product_name, SUM(oi.price_usd) - COALESCE(SUM(r.refund_amount_usd), 0) AS net_revenue FROM order_items oi JOIN products p ON oi.product_id = p.product_id LEFT JOIN refunds r ON oi.order_item_id = r.order_item_id GROUP BY oi.product_id, p.product_name ORDER BY net_revenue DESC",
    "metadata": {
      "doc_type": "sql_example",
      "use_case": "product_analysis"
    }
  },
  {
    "id": "sql:conversion_rate",
    "text": "SQL - Session to order conversion rate: SELECT CAST(COUNT(DISTINCT o.order_id) AS FLOAT) / NULLIF(COUNT(DISTINCT s.session_id), 0) AS conversion_rate FROM sessions s LEFT JOIN orders o ON s.session_id = o.session_id",
    "metadata": {
      "doc_type": "sql_example",
      "use_case": "conversion_rate"
    }
  },
  {
    "id": "sql:revenue_by_source",
    "text": "SQL - Revenue by marketing source (last-touch): SELECT s.utm_source, SUM(oi.price_usd) - COALESCE(SUM(r.refund_amount_usd), 0) AS net_revenue FROM sessions s JOIN orders o ON s.session_id = o.session_id JOIN order_items oi ON o.order_id = oi.order_id LEFT JOIN refunds r ON oi.order_item_id = r.order_item_id GROUP BY s.utm_source ORDER BY net_revenue DESC",
    "metadata": {
      "doc_type": "sql_example",
      "use_case": "attribution"
    }
  },
  {
    "id": "sql:aov_calculation",
    "text": "SQL - Average Order Value: WITH order_revenue AS (SELECT o.order_id, SUM(oi.price_usd) - COALESCE(SUM(r.refund_amount_usd), 0) AS net_rev FROM orders o JOIN order_items oi ON o.order_id = oi.order_id LEFT JOIN refunds r ON oi.order_item_id = r.order_item_id GROUP BY o.order_id) SELECT AVG(net_rev) AS aov FROM order_revenue WHERE net_rev > 0",
    "metadata": {
      "doc_type": "sql_example",
      "use_case": "aov"
    }
  },
  {
    "id": "sql:primary_vs_addon_revenue",
    "text": "SQL - Primary vs Add-on revenue split: SELECT CASE WHEN is_primary_item = 1 THEN 'Primary' ELSE 'Add-on' END AS item_type, SUM(price_usd) - COALESCE(SUM(r.refund_amount_usd), 0) AS net_revenue FROM order_items oi LEFT JOIN refunds r ON oi.order_item_id = r.order_item_id GROUP BY CASE WHEN is_primary_item = 1 THEN 'Primary' ELSE 'Add-on' END",
    "metadata": {
      "doc_type": "sql_example",
      "use_case": "revenue_segmentation"
    }
  },
  {
    "id": "intent:best_channel",
    "text": "User asks: 'best channel', 'top marketing source', 'which source drives most revenue' -> Query sessions joined to orders/order_items, GROUP BY utm_source, calculate net revenue, ORDER BY DESC.",
    "metadata": {
      "doc_type": "intent",
      "user_intent": "top_channel"
    }
  },
  {
    "id": "intent:worst_products",
    "text": "User asks: 'worst products', 'highest refund rate products', 'problematic products' -> Query order_items joined to refunds, GROUP BY product_id, calculate refund_rate, ORDER BY refund_rate DESC.",
    "metadata": {
      "doc_type": "intent",
      "user_intent": "problematic_products"
    }
  },
  {
    "id": "intent:mobile_vs_desktop",
    "text": "User asks: 'mobile vs desktop', 'device performance', 'mobile revenue' -> Query sessions joined to orders/order_items, GROUP BY device_type, calculate metrics (revenue, conversion, etc).",
    "metadata": {
      "doc_type": "intent",
      "user_intent": "device_analysis"
    }
  },
  {
    "id": "intent:repeat_customers",
    "text": "User asks: 'repeat customers', 'loyal customers', 'customers who bought multiple times' -> Query orders, GROUP BY user_id, HAVING COUNT(DISTINCT order_id) >= 2.",
    "metadata": {
      "doc_type": "intent",
      "user_intent": "customer_loyalty"
    }
  },
  {
    "id": "intent:recent_timeframe",
    "text": "User asks: 'recent', 'last week', 'last month', 'past 30 days' -> Apply time filter: WHERE created_at >= DATEADD(day, -N, GETDATE()) where N is the number of days.",
    "metadata": {
      "doc_type": "intent",
      "user_intent": "time_filter"
    }
  }
]